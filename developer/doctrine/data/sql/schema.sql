CREATE TABLE action (actionid BIGINT AUTO_INCREMENT, resourceid BIGINT, action VARCHAR(255), INDEX resourceid_idx (resourceid), PRIMARY KEY(actionid)) DEFAULT CHARACTER SET utf8 COLLATE utf8_bin ENGINE = INNODB;
CREATE TABLE assertion (assertionid BIGINT AUTO_INCREMENT, assertionname VARCHAR(255), PRIMARY KEY(assertionid)) DEFAULT CHARACTER SET utf8 COLLATE utf8_bin ENGINE = INNODB;
CREATE TABLE module (moduleid BIGINT AUTO_INCREMENT, modulename VARCHAR(255), PRIMARY KEY(moduleid)) DEFAULT CHARACTER SET utf8 COLLATE utf8_bin ENGINE = INNODB;
CREATE TABLE resource (resourceid BIGINT AUTO_INCREMENT, moduleid BIGINT, controller VARCHAR(255), INDEX moduleid_idx (moduleid), PRIMARY KEY(resourceid)) DEFAULT CHARACTER SET utf8 COLLATE utf8_bin ENGINE = INNODB;
CREATE TABLE role (roleid BIGINT AUTO_INCREMENT, rolename VARCHAR(255), inheritrole BIGINT, INDEX inheritrole_idx (inheritrole), PRIMARY KEY(roleid)) DEFAULT CHARACTER SET utf8 COLLATE utf8_bin ENGINE = INNODB;
CREATE TABLE role_access (id BIGINT AUTO_INCREMENT, roleid BIGINT, resourceid BIGINT, actionid BIGINT, allow ENUM('deny', 'allow'), assertionid BIGINT, INDEX roleid_idx (roleid), INDEX resourceid_idx (resourceid), INDEX actionid_idx (actionid), INDEX assertionid_idx (assertionid), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_bin ENGINE = INNODB;
CREATE TABLE user (userid BIGINT AUTO_INCREMENT, firstname VARCHAR(255), surname VARCHAR(255), username VARCHAR(16), email VARCHAR(255), password VARCHAR(255), PRIMARY KEY(userid)) DEFAULT CHARACTER SET utf8 COLLATE utf8_bin ENGINE = INNODB;
CREATE TABLE user_role (user_id BIGINT, role_id BIGINT, PRIMARY KEY(user_id, role_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_bin ENGINE = INNODB;
ALTER TABLE action ADD CONSTRAINT action_resourceid_resource_resourceid FOREIGN KEY (resourceid) REFERENCES resource(resourceid);
ALTER TABLE resource ADD CONSTRAINT resource_moduleid_module_moduleid FOREIGN KEY (moduleid) REFERENCES module(moduleid);
ALTER TABLE role ADD CONSTRAINT role_inheritrole_role_roleid FOREIGN KEY (inheritrole) REFERENCES role(roleid);
ALTER TABLE role_access ADD CONSTRAINT role_access_roleid_role_roleid FOREIGN KEY (roleid) REFERENCES role(roleid);
ALTER TABLE role_access ADD CONSTRAINT role_access_resourceid_resource_resourceid FOREIGN KEY (resourceid) REFERENCES resource(resourceid);
ALTER TABLE role_access ADD CONSTRAINT role_access_assertionid_assertion_assertionid FOREIGN KEY (assertionid) REFERENCES assertion(assertionid);
ALTER TABLE role_access ADD CONSTRAINT role_access_actionid_action_actionid FOREIGN KEY (actionid) REFERENCES action(actionid);
ALTER TABLE user_role ADD CONSTRAINT user_role_user_id_user_userid FOREIGN KEY (user_id) REFERENCES user(userid);
ALTER TABLE user_role ADD CONSTRAINT user_role_role_id_role_roleid FOREIGN KEY (role_id) REFERENCES role(roleid);
